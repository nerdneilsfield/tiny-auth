# ç”Ÿäº§ç¯å¢ƒé…ç½®ç¤ºä¾‹ - ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯

[server]
port = "8080"
auth_path = "/auth"
health_path = "/health"
read_timeout = 10
write_timeout = 10

# ğŸ”’ CRITICAL: Configure trusted proxies for production!
# Only trust your reverse proxy (Traefik/Nginx)
trusted_proxies = ["172.16.0.0/12"]  # Docker bridge network

[headers]
user_header = "X-Auth-User"
role_header = "X-Auth-Role"
method_header = "X-Auth-Method"
extra_headers = ["X-Auth-Timestamp"]
include_jwt_metadata = true

[logging]
format = "json"  # ç”Ÿäº§ç¯å¢ƒæ¨è JSON æ ¼å¼
level = "info"

# ===== Basic Authï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰=====
[[basic_auth]]
name = "admin"
user = "admin"
pass = "env:ADMIN_PASSWORD"  # ä»ç¯å¢ƒå˜é‡è¯»å–
roles = ["admin", "user"]

[[basic_auth]]
name = "operator"
user = "operator"
pass = "env:OPERATOR_PASSWORD"
roles = ["operator"]

# ===== Bearer Tokenï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰=====
[[bearer_token]]
name = "production-api"
token = "env:PRODUCTION_API_TOKEN"
roles = ["admin", "service"]

[[bearer_token]]
name = "monitoring"
token = "env:MONITORING_TOKEN"
roles = ["readonly", "monitoring"]

# ===== API Keyï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰=====
[[api_key]]
name = "service-a"
key = "env:SERVICE_A_API_KEY"
roles = ["internal", "service"]

[[api_key]]
name = "service-b"
key = "env:SERVICE_B_API_KEY"
roles = ["internal", "service"]

# ===== JWT é…ç½®ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰=====
[jwt]
secret = "env:JWT_SECRET"
issuer = "production-auth-service"
audience = "production-api"

# ===== è·¯ç”±ç­–ç•¥ =====

# å¥åº·æ£€æŸ¥å’Œå…¬å…±ç«¯ç‚¹ï¼ˆåŒ¿åï¼‰
[[route_policy]]
name = "public-endpoints"
path_prefix = "/health"
allow_anonymous = true

[[route_policy]]
name = "metrics"
path_prefix = "/metrics"
allow_anonymous = true

# ç®¡ç†é¢æ¿ï¼ˆä»… adminï¼‰
[[route_policy]]
name = "admin-panel"
host = "admin.example.com"
allowed_basic_names = ["admin"]
require_all_roles = ["admin"]

# ç”Ÿäº§ APIï¼ˆBearer Token æˆ– JWTï¼‰
[[route_policy]]
name = "production-api"
host = "api.example.com"
allowed_bearer_names = ["production-api"]
require_any_role = ["admin", "service"]

# å†…éƒ¨å¾®æœåŠ¡é€šä¿¡ï¼ˆAPI Keyï¼‰
[[route_policy]]
name = "internal-services"
host = "internal.example.com"
allowed_api_key_names = ["service-a", "service-b"]
require_all_roles = ["internal", "service"]

# ç›‘æ§æœåŠ¡ï¼ˆåªè¯»æƒé™ï¼‰
[[route_policy]]
name = "monitoring"
host = "monitoring.example.com"
allowed_bearer_names = ["monitoring"]
require_any_role = ["readonly", "monitoring"]
